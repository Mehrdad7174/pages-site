import{j as s,r as i,R as q,a as _}from"./index-Ci3oN4Mi.js";function F({type:e}){return s.jsx("div",{className:`cell ${e}`})}function V({currentBoard:e}){return s.jsx("div",{className:"board",role:"grid",children:e.map((t,r)=>s.jsx("div",{className:"row",children:t.map((o,a)=>s.jsx(F,{type:o},`${r}-${a}`))},`${r}`))})}var P=(e=>(e.I="I",e.J="J",e.L="L",e.O="O",e.S="S",e.T="T",e.Z="Z",e))(P||{}),I=(e=>(e.EMPTY="EMPTY",e))(I||{});const x={I:{shape:[[!1,!1,!1,!1],[!1,!1,!1,!1],[!0,!0,!0,!0],[!1,!1,!1,!1]]},J:{shape:[[!1,!1,!1],[!0,!1,!1],[!0,!0,!0]]},L:{shape:[[!1,!1,!1],[!1,!1,!0],[!0,!0,!0]]},O:{shape:[[!0,!0],[!0,!0]]},S:{shape:[[!1,!1,!1],[!1,!0,!0],[!0,!0,!1]]},T:{shape:[[!1,!1,!1],[!1,!0,!1],[!0,!0,!0]]},Z:{shape:[[!1,!1,!1],[!0,!0,!1],[!1,!0,!0]]}};function Z({upcomingBlock:e}){return s.jsx("div",{className:"upcoming",children:e.map((t,r)=>{let o=x[t].shape.filter(a=>a.some(n=>n));return s.jsx("div",{children:o.map((a,n)=>{a.map((l,d)=>{const p=l?t:"hidden",c=`${r}-${n}-${d}`;return s.jsx("div",{className:`cell ${p}`},c)})})},r)})})}const K=10,C=20;function W(){const[e,t]=i.useReducer(z,{board:[],droppingRow:0,droppingColumn:0,droppingBlock:P.I,droppingShape:x.I.shape},r=>({...r,board:E()}));return[e,t]}function E(e=C){return Array(e).fill(null).map(()=>Array(K).fill(I.EMPTY))}function b(e,t,r,o){let a=!1;return t.filter(n=>n.some(l=>l)).forEach((n,l)=>{n.forEach((d,p)=>{d&&(r+l>=e.length||o+p>=e[0].length||o+p<0||e[r+l][o+p]!==I.EMPTY)&&(a=!0)})}),a}function k(){const e=Object.values(P);return e[Math.floor(Math.random()*e.length)]}function X(e){const t=e.length,r=e[0].length,o=Array(t).fill(null).map(()=>Array(r).fill(!1));for(let a=0;a<t;a++)for(let n=0;n<r;n++)o[n][t-a-1]=e[a][n];return o}function z(e,t){let r={...e};switch(t.type){case"start":const o=k();return{board:E(),droppingRow:0,droppingColumn:3,droppingBlock:o,droppingShape:x[o].shape};case"drop":r.droppingRow+=1;break;case"commit":if(!t.newBoard||!t.newBlock)throw new Error("Invalid commit action: newBoard or newBlock is missing");return{board:[...E(C-t.newBoard.length),...t.newBoard],droppingRow:0,droppingColumn:3,droppingBlock:t.newBlock,droppingShape:x[t.newBlock].shape};case"move":const a=t.isRotating?X(r.droppingShape):r.droppingShape;let n=t.isPressingLeft?-1:0;n=t.isPressingRight?1:n,b(r.board,a,r.droppingRow,r.droppingColumn+n)||(r.droppingColumn+=n,r.droppingShape=a);break;case"reset":return{board:E(),droppingRow:0,droppingColumn:3,droppingBlock:k(),droppingShape:x[k()].shape};default:const l=t.type;throw new Error(`Unhandled action type: ${l}`)}return r}function Q(e,t){const r=i.useRef(e);i.useEffect(()=>{r.current=e},[e]),i.useEffect(()=>{if(t===null)return;const o=setInterval(()=>r.current(),t);return()=>clearInterval(o)},[t])}const M=10;function ee(e){const t=JSON.parse(localStorage.getItem("highScore")||"[]");t.push(e);const r=t.sort((o,a)=>a-o).slice(0,M);localStorage.setItem("highScore",JSON.stringify(r))}function $(){try{const e=JSON.parse(localStorage.getItem("highScore")||"[]");return Array.isArray(e)?e.sort((t,r)=>r-t).slice(0,M):[]}catch{return[]}}function te(){const[e,t]=i.useState(0),[r,o]=i.useState([]),[a,n]=i.useState(!1),[l,d]=i.useState(!1),[p,c]=i.useState(null),[{board:g,droppingRow:v,droppingColumn:j,droppingBlock:A,droppingShape:B},f]=W(),J=i.useCallback(()=>{console.log("Starting game...");const u=[k(),k(),k()];t(0),o(u),n(!1),d(!0),c(900),f({type:"start"})},[f]),L=i.useCallback(()=>{if(!b(g,B,v+1,j)){n(!1),c(900);return}const u=structuredClone(g);O(u,A,B,v,j);let y=0;for(let h=C-1;h>=0;h--)u[h].every(R=>R!==I.EMPTY)&&(y++,u.splice(h,1));const S=structuredClone(r),w=S.pop();S.unshift(k()),b(g,x[w].shape,0,3)?(ee(e),d(!1),c(null)):c(900),o(S),t(h=>h+re(y)),f({type:"commit",newBoard:[...E(C-u.length),...u],newBlock:w}),n(!1)},[g,f,A,j,v,B,r,e]),Y=i.useCallback(()=>{a?L():b(g,B,v+1,j)?(c(100),n(!0)):f({type:"drop"})},[g,L,f,j,v,B,a]);Q(()=>{l&&Y()},p),i.useEffect(()=>{if(!l)return;let u=!1,y=!1,S;const w=()=>{clearInterval(S),f({type:"move",isPressingLeft:u,isPressingRight:y}),S=setInterval(()=>{f({type:"move",isPressingLeft:u,isPressingRight:y})},300)},h=m=>{m.repeat||(m.key==="ArrowDown"&&c(200),m.key==="ArrowUp"&&f({type:"move",isRotating:!0}),m.key==="ArrowLeft"&&(u=!0,w()),m.key==="ArrowRight"&&(y=!0,w()))},R=m=>{m.key==="ArrowDown"&&c(900),m.key==="ArrowLeft"&&(u=!1,w()),m.key==="ArrowRight"&&(y=!1,w())};return document.addEventListener("keydown",h),document.addEventListener("keyup",R),()=>{document.removeEventListener("keydown",h),document.removeEventListener("keyup",R),clearInterval(S),c(900)}},[f,l]);const H=structuredClone(g);return l&&O(H,A,B,v,j),{board:H,startGame:J,isPlaying:l,score:e,upcomingBlock:r,highScores:$()}}function re(e){switch(e){case 0:return 0;case 1:return 100;case 2:return 300;case 3:return 500;case 4:return 800;default:throw new Error(`Unexpected number of cleared rows: ${e}`)}}function O(e,t,r,o,a){r.filter(n=>n.some(l=>l)).forEach((n,l)=>{n.forEach((d,p)=>{d&&(e[o+l][a+p]=t)})})}function se(){const e=$().slice(0,10);return e.length===0?s.jsxs("div",{className:"high-scores",children:[s.jsx("h2",{children:"High Scores"}),s.jsx("p",{children:"No high scores yet!"})]}):s.jsxs("div",{className:"high-scores",children:[s.jsx("h2",{children:"High Scores"}),s.jsx("ol",{className:"high-scores-list",children:e.map((t,r)=>s.jsx("li",{className:"high-score-item",children:t},r))})]})}function ne(){const{board:e,startGame:t,isPlaying:r,score:o,upcomingBlock:a,resetGame:n}=te(),[l,d]=i.useState(!0),p=()=>{d(!1)},c=()=>{d(!0),n(),t()};return s.jsxs("div",{className:"app",children:[s.jsx("h1",{children:"Tetris"}),!l&&s.jsx("div",{className:"home-buttons",children:s.jsx("button",{onClick:c,children:"Tetris"})}),l&&s.jsxs(s.Fragment,{children:[s.jsx(V,{currentBoard:e}),s.jsxs("div",{className:"controls",children:[s.jsxs("h2",{children:["Score: ",o]}),r?s.jsxs(s.Fragment,{children:[s.jsx(Z,{upcomingBlock:a}),s.jsx("button",{onClick:p,children:"Hide Game"})]}):s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:t,children:" New Game"}),s.jsx("button",{onClick:n,children:"Reset Game"}),s.jsx(se,{})]})]})]})]})}const D=document.getElementById("root");if(!D)throw new Error("Root element not found");const oe=q.createRoot(D);oe.render(s.jsx(_.StrictMode,{children:s.jsx(ne,{})}));const N=document.querySelector("#start-game"),G=document.querySelector("#new-game"),T=document.querySelector("#hide-game"),U=document.querySelector("#root");N.addEventListener("click",()=>{U.style.display="block",N.style.display="none",G.style.display="inline-block",T.style.display="inline-block"});G.addEventListener("click",()=>{location.reload()});T.addEventListener("click",()=>{U.style.display="none",N.style.display="inline-block",G.style.display="none",T.style.display="none"});
